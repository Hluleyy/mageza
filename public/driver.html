<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <title>Driver Profile - Mageza App</title>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var map = L.map('map').setView([-26.2041, 28.0473], 12); // Johannesburg default
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: 'Â© OpenStreetMap'
        }).addTo(map);
        window.leafletMap = map;
      });
    </script>
  <style>
    /* Custom marker styles for better visibility */
    .sim-marker {
      font-weight: bold;
      text-shadow: 0 1px 3px rgba(0,0,0,0.7);
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    /* Flash animation for emergency button */
    @keyframes flash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5fafd; }
    .status { text-align: center; margin-top: 1em; color: #1976d2; }
    
    /* Emergency/Heist Reporting Styles */
    .emergency-report {
      background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
      border: 2px solid #ff0000;
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-weight: bold;
      font-size: 1.2rem;
      margin: 1rem auto;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
      transition: all 0.3s ease;
      max-width: 300px;
      text-align: center;
    }
    
    .emergency-report:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(255, 0, 0, 0.6);
    }
    
    .emergency-report:active {
      transform: scale(0.95);
    }
    
    .location-info {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .location-coordinates {
      font-family: monospace;
      font-size: 1.1rem;
      color: #1976d2;
      margin: 0.5rem 0;
    }
    
    .location-timestamp {
      font-size: 0.9rem;
      color: #6c757d;
    }
    
    /* Profile Component Styles */
    .profile-picture-component {
      background: linear-gradient(135deg, #ffffff 0%, #0177d8 100%);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1rem auto;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 1px solid #e9ecef;
      max-width: 950px;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .profile-avatar-container {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid #00d9ff;
      box-shadow: 0 2px 8px rgba(1, 90, 555, 0.89);
    }

    .profile-avatar {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .profile-avatar:hover {
      transform: scale(1.5);
    }

    .profile-upload-overlay {
      position: absolute;
      bottom: 0;
      right: 0;
      background: rgba(3, 212, 240, 0.925);
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .profile-upload-overlay:hover {
      background: rgba(21, 101, 192, 0.9);
    }

    .upload-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 0;
      width: 20px;
      height: 20px;
    }

    .profile-info {
      flex: 1;
    }

    .profile-greeting {
      color: #1976d2;
      font-size: 1.2rem;
      font-weight: 600;
      margin: 0 0 0.5rem 0;
    }

    .profile-name {
      color: #052cdab7;
      font-size: 1rem;
      font-weight: 500;
      margin: 0 0 0.25rem 0;
    }

    .profile-type {
      color: #056380dc;
      font-size: 0.9rem;
      margin: 0;
      text-transform: capitalize;
    }

    .profile-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
    }

    .profile-action-btn {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      background: linear-gradient(90deg, #1976d2 60%, #42a5f5 100%);
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .profile-action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
    }

    @media (max-width: 600px) {
      .profile-header {
        flex-direction: column;
        text-align: center;
      }
      
      .profile-avatar-container {
        width: 70px;
        height: 70px;
      }
      
      .profile-greeting {
        font-size: 1.1rem;
      }
      
      .emergency-report {
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>

<!-- Profile Picture Component -->
<div class="profile-picture-component">
  <div class="profile-header">
    <div class="profile-avatar-container">
      <img id="profileAvatar" src="mageza-logo.png" alt="Profile Picture" class="profile-avatar">
      <div class="profile-upload-overlay">
        <button class="upload-btn" onclick="document.getElementById('profileUploadInput').click()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="profile-info">
      <h2 id="profileGreeting" class="profile-greeting"></h2>
      <p id="profileName" class="profile-name"></p>
      <p id="profileType" class="profile-type"></p>
    </div>
  </div>
  
  <input type="file" id="profileUploadInput" style="display:none" accept="image/*" onchange="handleProfileUpload(event)">




  <div class="profile-container">
    <h1>Driver Dashboard</h1>
    <p>Check your assigned routes, schedules, and notifications here.</p>
    <ul>
      <li>
        <img src="route.png" alt="Routes" style="height:1.5em;width:1.5em;vertical-align:middle;margin-right:0.5em;">
        <a href="routes-frequent-sujgestions.html">My Routes</a>
      </li>
      <li>
        <img src="schedule.png" alt="Schedule" style="height:1.5em;width:1.5em;vertical-align:middle;margin-right:0.5em;">
        <a id="routePlannerModalTemplate" onclick="openMapModal()">Schedule</a>
      </li>

      <li>
        <img src="notification.png" alt="Notifications" style="height:1.5em;width:1.5em;vertical-align:middle;margin-right:0.5em;">
        <a href="driver-spaces.html">Driver Spaces</a>
      </li>

      <li>
        <img src="notification.png" alt="Notifications" style="height:1.5em;width:1.5em;vertical-align:middle;margin-right:0.5em;">
        <a href="driver-spaces.html">Request Break</a>
      </li>

    </ul>
    <button class="modern-btn" onclick="window.location.href='index.html'">Logout</button>
    <hr/>
    
    <!-- Emergency Location Reporting Section -->
    <div class="emergency-report" onclick="reportEmergencyLocation()">
      ðŸš¨ EMERGENCY LOCATION REPORT ðŸš¨
    </div>
    
    <div id="locationInfo" class="location-info" style="display: none;">
      <h3>Current Location Reported</h3>
      <div id="locationCoordinates" class="location-coordinates"></div>
      <div id="locationTimestamp" class="location-timestamp"></div>
      <button class="modern-btn" onclick="copyLocationToClipboard()">Copy Coordinates</button>
    </div>
    
    <h2>Passenger Map (Prototype)</h2>
    <div id="map" class="map-rounded"></div>


    <div class="sim-btn-grid glass-blue-panel scatter-panel">
      <button class="modern-btn dj-btn" id="simShowPassengers">Show Passengers</button>
      <button class="modern-btn dj-btn" id="simShowInTaxis">Show In-Taxi Passengers</button>
      <button class="modern-btn dj-btn" id="simShowDriver">Show Driver</button>
      <button class="modern-btn dj-btn" id="simMoveDriver">Move Driver</button>
      <button class="modern-btn dj-btn" id="simPickup">Pick Up Nearby Passenger</button>
      <button class="modern-btn dj-btn" id="simRequestPickup">Request Pickup</button>
      <button class="modern-btn dj-btn" id="simShowRequests">Show Pickup Requests</button>
      <button class="modern-btn dj-btn" id="simAcceptRequest">Accept Pickup Request</button>
      <button class="modern-btn dj-btn" id="simAnimate">Auto Animate</button>
    </div>
    <p id="mapStatus"></p>
    <ul id="inTaxiList"></ul>
    <ul id="pickupRequests"></ul>
  <footer style="z-index: 50;">
    <p>&copy; 2025 Mageza App. All rights reserved.</p>
    <p>by the Mageza team.</p>
  </footer>
  </div>
  
  <script>
// Profile component functionality for driver page
function loadProfileData() {
  try {
    // Get current user from localStorage or session
    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
    const users = JSON.parse(localStorage.getItem('magezaUsers') || '[]');
    
    let userData = currentUser;
    if (!userData.name && users.length > 0) {
      // Find a driver user
      const driverUser = users.find(u => u.userType === 'Driver') || users[0] || {};
      userData = driverUser;
    }
    
    // Update profile information
    if (userData.name) {
      document.getElementById('profileName').textContent = userData.name;
    }
    
    if (userData.userType) {
      document.getElementById('profileType').textContent = "Welcome to your dashboard where everything is easy";
    }
    
    // Set greeting based on time of day
    const hour = new Date().getHours();
    let greeting = 'Welcome';
    if (hour < 12) greeting = 'Good morning';
    else if (hour < 18) greeting = 'Good afternoon';
    else greeting = 'Good evening';
    
    if (userData.name) {
      document.getElementById('profileGreeting').textContent = `${greeting}, ${userData.name.split(' ')[0]}`;
    } else {
      document.getElementById('profileGreeting').textContent = `${greeting}`;
    }
    
    // Load profile picture if available
    const profilePic = localStorage.getItem('profilePicture');
    if (profilePic) {
      document.getElementById('profileAvatar').src = profilePic;
    }
    
  } catch (error) {
    console.error('Error loading profile data:', error);
  }
}

function handleProfileUpload(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      // Update profile picture
      document.getElementById('profileAvatar').src = e.target.result;
      
      // Save to localStorage
      localStorage.setItem('profilePicture', e.target.result);
      
      alert('Profile picture updated successfully!');
    };
    reader.readAsDataURL(file);
  }
}

// Initialize profile component
document.addEventListener('DOMContentLoaded', function() {
  loadProfileData();
});
</script>
  <script>
    // --- Simple Map Simulation for Prototype ---
    const mapSim = document.getElementById('map-sim');

    let simMarkers = [];
    let passengers = [];
    let inTaxiPassengers = [];
    let driver = null;
    let animateInterval = null;
    let pickupRequestsArr = [];
    let emergencyMarker = null;
    
    // Initialize Leaflet map
    document.addEventListener('DOMContentLoaded', function() {
      var map = L.map('map-sim').setView([-26.2041, 28.0473], 12); // Johannesburg default
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
      }).addTo(map);
      window.leafletMap = map;
      
      // Setup button event listeners
      setupButtonListeners();
    });
    
    function setupButtonListeners() {
      // Move driver in a realistic direction
      document.getElementById('simMoveDriver').onclick = function() {
        if (!driver) { document.getElementById('mapStatus').textContent = 'Show driver first!'; return; }
        // Simulate a random heading and distance (max ~500m per move)
        let heading = Math.random() * 2 * Math.PI;
        let distance = Math.random() * 0.005; // ~0-500m
        let dLat = Math.cos(heading) * distance;
        let dLng = Math.sin(heading) * distance / Math.cos(driver.lat * Math.PI/180);
        driver.lat += dLat;
        driver.lng += dLng;
        redrawAll();
        window.leafletMap.setView([driver.lat, driver.lng], window.leafletMap.getZoom());
        document.getElementById('mapStatus').textContent = 'Driver moved!';
      };
      
      // Passengers request pickup (randomly select some not in taxi)
      document.getElementById('simRequestPickup').onclick = function() {
        pickupRequestsArr = [];
        passengers.forEach(p => {
          if (!p.inTaxi && Math.random() < 0.5) {
            pickupRequestsArr.push(p);
          }
        });
        updatePickupRequests();
        document.getElementById('mapStatus').textContent = pickupRequestsArr.length ? 'Pickup requests sent!' : 'No requests.';
      };

      // Show pickup requests
      document.getElementById('simShowRequests').onclick = function() {
        updatePickupRequests();
        document.getElementById('mapStatus').textContent = 'Showing pickup requests.';
      };

      // Accept a pickup request (pick the closest one)
      document.getElementById('simAcceptRequest').onclick = function() {
        if (!driver || pickupRequestsArr.length === 0) {
          document.getElementById('mapStatus').textContent = 'No driver or no requests.';
          return;
        }
        // Find closest request using haversine distance
        let minDist = Infinity, minP = null;
        pickupRequestsArr.forEach(p => {
          let R = 6371e3; // meters
          let dLat = (p.lat - driver.lat) * Math.PI/180;
          let dLng = (p.lng - driver.lng) * Math.PI/180;
          let a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(driver.lat * Math.PI/180) * Math.cos(p.lat * Math.PI/180) * Math.sin(dLng/2) * Math.sin(dLng/2);
          let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
          let dist = R * c;
          if (dist < minDist) { minDist = dist; minP = p; }
        });
        if (minP) {
          minP.inTaxi = true;
          inTaxiPassengers.push(minP);
          pickupRequestsArr = pickupRequestsArr.filter(p => p.id !== minP.id);
          redrawAll();
          updateInTaxiList();
          updatePickupRequests();
          document.getElementById('mapStatus').textContent = `Accepted pickup for ${minP.id.toUpperCase()}`;
        }
      };
      
      // Animate movement for simulation purposes
      document.getElementById('simAnimate').onclick = function() {
        if (animateInterval) { 
          clearInterval(animateInterval); 
          animateInterval = null; 
          this.textContent = 'Auto Animate'; 
          return; 
        }
        this.textContent = 'Stop Animation';
        animateInterval = setInterval(() => {
          movePassengers();
          redrawAll();
        }, 1200);
      };
    }

    function updatePickupRequests() {
      const ul = document.getElementById('pickupRequests');
      ul.innerHTML = '';
      pickupRequestsArr.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `Passenger ${p.id.toUpperCase()} requests pickup.`;
        ul.appendChild(li);
      });
    }

    // Add marker to Leaflet map
    function addMarker(lat, lng, color, label, id, border = '') {
      const iconHtml = `<div style="background:${color};color:#fff;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:15px;box-shadow:0 0 8px #333;${border ? 'border:' + border + ';' : ''}">${label}</div>`;
      const marker = L.marker([lat, lng], {
        icon: L.divIcon({
          className: 'sim-marker',
          html: iconHtml,
          iconSize: [28, 28],
          iconAnchor: [14, 14]
        })
      }).addTo(window.leafletMap);
      simMarkers.push(marker);
    }

    function clearMarkers() {
      simMarkers.forEach(m => window.leafletMap.removeLayer(m));
      simMarkers = [];
    }

    // Show driver marker
    document.getElementById('simShowDriver').onclick = function() {
      console.log('Show Driver clicked. Current driver:', driver);
      if (!driver) {
        // Place driver at Johannesburg center
        driver = { lat: -26.2041, lng: 28.0473 };
        console.log('Driver initialized at:', driver);
      }
      redrawAll();
      window.leafletMap.setView([driver.lat, driver.lng], window.leafletMap.getZoom());
      document.getElementById('mapStatus').textContent = 'Driver shown!';
    };

    // Simulate showing passengers on the map
    document.getElementById('simShowPassengers').onclick = function() {
      passengers = [];
      for (let i = 0; i < 4; i++) {
        // Place passengers within Johannesburg bounds
        const lat = -26.2041 + (Math.random() - 0.5) * 0.08; // ~8km N/S
        const lng = 28.0473 + (Math.random() - 0.5) * 0.08; // ~8km E/W
        passengers.push({ id: 'p'+i, lat, lng, lastLat: lat, lastLng: lng, lastMove: Date.now(), color: '#d32f2f', inTaxi: false });
      }
      redrawAll();
      document.getElementById('mapStatus').textContent = 'Passengers placed!';
      updateInTaxiList();
    };

    // Simulate passenger movement - passengers in other taxis show as green, available as red
    function movePassengers() {
      passengers.forEach((p, idx) => {
        if (p.inTaxi) {
          // Passenger is in another taxi - show as green
          p.color = '#388e3c'; // green
          return;
        }
        
        // Available passenger - show as red and allow movement
        p.color = '#d32f2f'; // red
        
        // Simulate a random heading and distance (max ~300m per move)
        let heading = Math.random() * 2 * Math.PI;
        let distance = Math.random() * 0.003; // ~0-300m
        let dLat = Math.cos(heading) * distance;
        let dLng = Math.sin(heading) * distance / Math.cos(p.lat * Math.PI/180);
        let newLat = p.lat + dLat;
        let newLng = p.lng + dLng;
        
        // Clamp to city bounds (Johannesburg area)
        newLat = Math.max(-26.25, Math.min(-26.15, newLat));
        newLng = Math.max(28.00, Math.min(28.10, newLng));
        
        p.lat = newLat;
        p.lng = newLng;
        p.lastMove = Date.now();
      });
    }

    // Simulate showing which passengers are already in other taxis (green pins)
    document.getElementById('simShowInTaxis').onclick = function() {
      inTaxiPassengers = [];
      if (passengers.length === 0) {
        document.getElementById('mapStatus').textContent = 'Show passengers first!';
        return;
      }
      
      // Mark 1-2 random passengers as being in other taxis (green pins)
      let count = Math.floor(Math.random() * 2) + 1;
      let availablePassengers = passengers.filter(p => !p.inTaxi);
      
      if (availablePassengers.length === 0) {
        document.getElementById('mapStatus').textContent = 'All passengers are already in taxis!';
        return;
      }
      
      for (let i = 0; i < Math.min(count, availablePassengers.length); i++) {
        let randomIndex = Math.floor(Math.random() * availablePassengers.length);
        let passenger = availablePassengers[randomIndex];
        passenger.inTaxi = true;
        passenger.color = '#388e3c'; // Green for in other taxi
        inTaxiPassengers.push(passenger);
        availablePassengers.splice(randomIndex, 1);
      }
      
      redrawAll();
      updateInTaxiList();
      document.getElementById('mapStatus').textContent = 'Passengers in other taxis shown as green pins!';
    };

    // Pick up a nearby passenger (within 30px)
    document.getElementById('simPickup').onclick = function() {
      if (!driver) { document.getElementById('mapStatus').textContent = 'Show driver first!'; return; }
      let found = false;
      passengers.forEach(p => {
        if (!p.inTaxi) {
          // Use haversine distance for ~meters
          let R = 6371e3; // meters
          let dLat = (p.lat - driver.lat) * Math.PI/180;
          let dLng = (p.lng - driver.lng) * Math.PI/180;
          let a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(driver.lat * Math.PI/180) * Math.cos(p.lat * Math.PI/180) * Math.sin(dLng/2) * Math.sin(dLng/2);
          let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
          let dist = R * c;
          if (dist < 100) { // 100 meters
            p.inTaxi = true;
            inTaxiPassengers.push(p);
            found = true;
          }
        }
      });
      redrawAll();
      updateInTaxiList();
      document.getElementById('mapStatus').textContent = found ? 'Picked up a passenger!' : 'No passenger nearby.';
    };

    function redrawAll() {
      console.log('Redrawing all markers. Driver:', driver, 'Passengers:', passengers.length);
      clearMarkers();
      // Draw driver
      if (driver) {
        console.log('Adding driver marker at:', driver);
        addMarker(driver.lat, driver.lng, '#1976d2', 'D', 'driver', '3px solid #fff');
      }
      
      // Draw passengers - red for available, green for in other taxis
      passengers.forEach(p => {
        let border = '';
        let label = 'P';
        
        // Highlight passengers with pickup requests
        if (pickupRequestsArr.find(r => r.id === p.id)) {
          label = 'P*';
          border = '2px solid #ff9900'; // Orange border for requested pickups
        }
        
        addMarker(p.lat, p.lng, p.color, label, p.id, border);
      });
      
      // Keep emergency marker if it exists
      if (emergencyMarker) {
        emergencyMarker.addTo(window.leafletMap);
        simMarkers.push(emergencyMarker);
      }
      
      // Ensure map is visible and properly sized
      setTimeout(() => {
        window.leafletMap.invalidateSize();
      }, 100);
    }

    function updateInTaxiList() {
      const ul = document.getElementById('inTaxiList');
      ul.innerHTML = '';
      inTaxiPassengers.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `Passenger ${p.id.toUpperCase()} is in a taxi.`;
        ul.appendChild(li);
      });
    }
    
    // --- Emergency Location Reporting Functionality ---
    function reportEmergencyLocation() {
      if (!navigator.geolocation) {
        alert('Geolocation is not supported by your browser.');
        return;
      }
      
      document.getElementById('mapStatus').textContent = 'Getting your emergency location...';
      
      navigator.geolocation.getCurrentPosition(
        function(position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          const timestamp = new Date().toLocaleString();
          
          // Display location information
          document.getElementById('locationCoordinates').textContent = `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
          document.getElementById('locationTimestamp').textContent = `Reported at: ${timestamp}`;
          document.getElementById('locationInfo').style.display = 'block';
          
          // Add emergency marker to map
          if (emergencyMarker) {
            window.leafletMap.removeLayer(emergencyMarker);
          }
          
          emergencyMarker = L.marker([lat, lng], {
            icon: L.divIcon({
              className: 'emergency-marker',
              html: '<div style="background: #ff0000; color: white; border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; box-shadow: 0 0 15px #ff0000; border: 3px solid white;">ðŸš¨</div>',
              iconSize: [35, 35],
              iconAnchor: [17, 17]
            })
          }).addTo(window.leafletMap).bindPopup('EMERGENCY LOCATION');
          
          simMarkers.push(emergencyMarker);
          
          // Center map on emergency location
          window.leafletMap.setView([lat, lng], 15);
          
          document.getElementById('mapStatus').textContent = 'EMERGENCY LOCATION REPORTED! Coordinates displayed below.';
          
          // Flash the emergency button
          const emergencyBtn = document.querySelector('.emergency-report');
          emergencyBtn.style.animation = 'flash 1s infinite';
          setTimeout(() => {
            emergencyBtn.style.animation = '';
          }, 3000);
        },
        function(error) {
          console.error('Geolocation error:', error);
          document.getElementById('mapStatus').textContent = 'Failed to get location. Please check permissions.';
        }
      );
    }
    
    // Copy location coordinates to clipboard
    function copyLocationToClipboard() {
      const coordinates = document.getElementById('locationCoordinates').textContent;
      if (coordinates) {
        navigator.clipboard.writeText(coordinates).then(() => {
          alert('Coordinates copied to clipboard: ' + coordinates);
        }).catch(err => {
          console.error('Failed to copy: ', err);
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = coordinates;
          document.body.appendChild(textArea);
          textArea.select();
          try {
            document.execCommand('copy');
            alert('Coordinates copied to clipboard: ' + coordinates);
          } catch (err) {
            alert('Failed to copy coordinates. Please copy manually.');
          }
          document.body.removeChild(textArea);
        });
      } else {
        alert('No coordinates available to copy.');
      }
    }